<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Server Logs Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        #logsContainer {
            background: #000;
            color: #0f0;
            padding: 15px;
            height: 70vh;
            overflow-y: scroll;
            font-family: monospace;
            white-space: pre-wrap;
            border: 1px solid #ccc;
        }
        .log-info {
            color: #00f; /* Blue */
        }
        .log-warn {
            color: #ffa500; /* Orange */
        }
        .log-error {
            color: #ff4c4c; /* Red */
        }
        .log-debug {
            color: #0f0; /* Greenish (default) */
        }
        .log-other {
            color: #bbb; /* Gray for unclassified logs */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="mb-4">üöÄ Server Logs Viewer (Color-Coded)</h2>

        <!-- Search + Download Controls -->
        <div class="row mb-3">
            <div class="col-md-4 mb-2">
                <input type="text" id="searchInput" class="form-control" placeholder="üîç Search logs...">
            </div>
            <div class="col-md-2 mb-2">
                <button class="btn btn-secondary w-100" id="searchBtn">Search</button>
            </div>
            <div class="col-md-6 mb-2 text-end">
                <input type="date" id="startDate">
                <input type="date" id="endDate">
                <button class="btn btn-success" id="downloadBtn">üì• Download Logs</button>
            </div>
        </div>

        <!-- Refresh Button -->
        <div class="mb-3">
            <button class="btn btn-primary" id="refreshBtn">üîÑ Refresh Logs</button>
        </div>

        <!-- Logs Display -->
        <div id="logsContainer">Loading logs...</div>
    </div>

    <script>
        let allLogs = '';

        // ‚úÖ Fetch all logs from backend
        async function fetchLogs() {
            document.getElementById('logsContainer').textContent = 'Loading logs...';
            try {
                const response = await fetch('/api/logs/all');
                if (response.ok) {
                    const text = await response.text();
                    allLogs = text;
                    renderLogs(text);
                } else {
                    document.getElementById('logsContainer').textContent = "‚ùå Failed to load logs.";
                }
            } catch (error) {
                document.getElementById('logsContainer').textContent = "‚ùå Error loading logs.";
            }
        }

        // ‚úÖ Render logs with color coding
        function renderLogs(logText) {
            const container = document.getElementById('logsContainer');
            container.innerHTML = '';  // Clear old logs

            const lines = logText.split('\n');
            lines.forEach(line => {
                const span = document.createElement('div');

                if (line.includes('ERROR')) {
                    span.className = 'log-error';
                } else if (line.includes('WARN')) {
                    span.className = 'log-warn';
                } else if (line.includes('INFO')) {
                    span.className = 'log-info';
                } else if (line.includes('DEBUG')) {
                    span.className = 'log-debug';
                } else {
                    span.className = 'log-other';
                }

                span.textContent = line;
                container.appendChild(span);
            });

            scrollToBottom();
        }

        // ‚úÖ Search logs client-side (keeps colors)
        document.getElementById('searchBtn').addEventListener('click', () => {
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!keyword) {
                renderLogs(allLogs);
                return;
            }
            const filtered = allLogs.split('\n').filter(line => line.toLowerCase().includes(keyword));
            renderLogs(filtered.join('\n'));
        });

        // ‚úÖ Download logs by date range
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (!startDate || !endDate) {
                alert("‚ö†Ô∏è Please select both start and end dates.");
                return;
            }
            const url = `/api/logs/download?startDate=${startDate}&endDate=${endDate}`;
            window.open(url, '_blank');
        });

        // ‚úÖ Refresh logs
        document.getElementById('refreshBtn').addEventListener('click', fetchLogs);

        // ‚úÖ Auto-scroll helper
        function scrollToBottom() {
            const container = document.getElementById('logsContainer');
            container.scrollTop = container.scrollHeight;
        }

        // Initial load
        fetchLogs();
    </script>
</body>
</html>
